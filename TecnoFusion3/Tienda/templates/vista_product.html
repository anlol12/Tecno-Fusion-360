{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/vistaProduc.css' %} ">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

    <title>{{ producto.nombre }}</title>

    <style>
       /* Título */
h1 {
    text-align: center;
    color: #333;
    margin-top: 20px;
}

/* Formulario */
form {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px;
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

textarea {
    width: 100%;
    height: 100px;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 16px;
    resize: none;
}

button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    background-color: #4CAF50;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background-color: #45a049;
}

/* Contenedor de comentarios */
.comentarios {
    margin: 20px;

}

/* Estilos para los comentarios */
.comentario {
    background-color: #fff;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    max-width: 800px; /* Limita el ancho de los comentarios */
    margin-left: auto;
    margin-right: auto;
}

.comentario p {
    margin: 5px 0;
}

.comentario strong {
    color: #333;
    font-weight: bold;
}

.comentario p:last-child {
    font-size: 0.9em;
    color: #777;
}

/* Respuestas */
.respuestas {
    margin-top: 15px;
    padding-left: 20px;
    border-left: 2px solid #ddd;
}

.comentario-respuesta {
    background-color: #f9f9f9;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    max-width: 750px;
    margin-left: auto;
    margin-right: auto;
}

.comentario-respuesta p {
    margin: 5px 0;
}

.comentario-respuesta strong {
    color: #333;
}


/*boton back*/
button {
    display: flex;
    height: 3em;
    width: 100px;
    align-items: center;
    justify-content: center;
    background-color: #eeeeee4b; /* Cambia este color de fondo */
    border-radius: 3px;
    letter-spacing: 1px;
    transition: all 0.2s linear;
    cursor: pointer;
    border: none;
    background: #3498db; /* Color específico para el botón */
    color: #fff; /* Color del texto */
}

button > svg {
    fill: #fff; /* Color específico para la flecha SVG */
    margin-right: 5px;
    margin-left: 5px;
    font-size: 20px;
    transition: all 0.4s ease-in;
}

button:hover > svg {
    font-size: 1.2em;
    transform: translateX(-5px);
}

button:hover {
    box-shadow: 9px 9px 33px #2980b9, -9px -9px 33px #ffffff; /* Colores de la sombra al hacer hover */
    transform: translateY(-2px);
}










/* vista_product.css */
.stars {
    color: gold;
    font-size: 1.2em;
}

.star {
    margin-right: 2px;
}

.calificacion-promedio, 
.calificaciones-barras, 
.calificacion-usuario,
.comentarios {
    margin-top: 20px;
}

.calificacion-barra {
    margin-bottom: 15px;
}

.calificacion-texto {
    margin-right: 10px;
    font-weight: bold;
}

.barra {
    width: 100%;
    background-color: #e0e0e0;  /* Color de fondo de la barra */
    height: 10px;
    border-radius: 5px;
    overflow: hidden;
}

.relleno {
    height: 100%;
    background-color: #ffb300;  /* Color amarillo de la barra de calificación */
    transition: width 0.5s ease;  /* Para suavizar el cambio de tamaño */
    width: 0%;  /* Inicialmente la barra está vacía */
}

.comentario {
    border-bottom: 1px solid #ccc;
    padding-bottom: 10px;
    margin-bottom: 10px;
}



    </style>
</head>
<body>

<div class="back-button-container" >
    <button onclick="window.location.href='{% url 'tienda' %}'">
      <svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1024 1024"><path d="M874.690416 495.52477c0 11.2973-9.168824 20.466124-20.466124 20.466124l-604.773963 0 188.083679 188.083679c7.992021 7.992021 7.992021 20.947078 0 28.939099-4.001127 3.990894-9.240455 5.996574-14.46955 5.996574-5.239328 0-10.478655-1.995447-14.479783-5.996574l-223.00912-223.00912c-3.837398-3.837398-5.996574-9.046027-5.996574-14.46955 0-5.433756 2.159176-10.632151 5.996574-14.46955l223.019353-223.029586c7.992021-7.992021 20.957311-7.992021 28.949332 0 7.992021 8.002254 7.992021 20.957311 0 28.949332l-188.073446 188.073446 604.753497 0C865.521592 475.058646 874.690416 484.217237 874.690416 495.52477z"></path></svg>
      <span>Back</span>
    </button>
</div>

    <div class="product-container">
        <div class="zoom-container">
            <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="product-img">
            <div class="zoom-lens"></div>
        </div>
        
        <div class="product-details">
            <h1>{{ producto.nombre }}</h1>
            <p><strong>Descripción:</strong> {{ producto.descripcion }}</p>
            <p><strong>Precio:</strong> ${{ producto.precio }}</p>
            <p><strong>Categoría:</strong> {{ producto.categoria.nombre }}</p>
        </div>
    </div>
    



<h1>Comentarios</h1>

    
<!-- En tu vista_product.html -->
<form method="POST" action="{% url 'agregar_comentario' producto.id %}">
    {% csrf_token %}
    
    <!-- Incluir el sistema de estrellas -->
    {% include 'calificacion.html' %}
    
    <textarea name="texto" required></textarea>
    <button type="submit">Comentar</button>
</form>

<!-- Para calificación promedio -->
<div class="rating-promedio">
    Calificación: 
    {% for i in producto.promedio_stars %}
        <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg" style="fill: #ffa723;">
            <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
        </svg>
    {% endfor %}
    ({{ producto.calificacion_promedio|floatformat:1 }}/5)
</div>

<div class="calificaciones-barras">
    <h3>Calificaciones de los clientes:</h3>
    {% for i in estrellas %}
        <div class="calificacion-barra">
            <span class="calificacion-texto">{{ i }} estrellas</span>
            <div class="barra">
                <!-- Calculamos el ancho de la barra en base al porcentaje -->
                <div class="relleno" style="width: {{ calificaciones_porcentajes.i }}%"></div>
            </div>
            <!-- Mostramos el porcentaje al lado de cada barra -->
            <span>{{ calificaciones_porcentajes.i|floatformat:1 }}%</span>
        </div>
    {% endfor %}
</div>





<div class="comentarios">
    {% csrf_token %} 
    <!-- Agrega esta línea justo después de abrir el div de comentarios-->
    {% for comentario in comentarios %}
        <div class="comentario">
            <!-- Nombre del usuario -->
            <strong>{{ comentario.usuario.username }}</strong>

            <!-- Fecha del comentario -->
            <span class="comentario-fecha">{{ comentario.fecha_formateada }}</span>

            <!-- Cantidad de estrellas -->
            <span class="rating-display">
                {% for i in comentario.star_range %}
                    <svg viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg" style="fill: #ffa723;">
                        <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
                    </svg>
                {% endfor %}
            </span>

            <!-- Texto del comentario -->
            <p>{{ comentario.texto }}</p>

            <!-- Pregunta de utilidad de la reseña en línea -->
            <p style="display: inline-block; margin-right: 10px;">¿Te ha parecido útil esta reseña?</p>
            
            <!-- Opciones de Sí y No, alineadas -->
            <label for="si_{{ comentario.id }}" style="margin-right: 15px;">
                <input type="radio" id="si_{{ comentario.id }}" name="utilidad_{{ comentario.id }}" value="si" 
                        {% if comentario.utilidad == 'si' %} checked {% endif %}
                        onchange="saveAnswer({{ comentario.id }}, 'si')"> Sí
            </label>
            <label for="no_{{ comentario.id }}">
                <input type="radio" id="no_{{ comentario.id }}" name="utilidad_{{ comentario.id }}" value="no" 
                        {% if comentario.utilidad == 'no' %} checked {% endif %}
                        onchange="saveAnswer({{ comentario.id }}, 'no')"> No
            </label>
        </div>
    {% endfor %}
</div>




    <script>
        function saveAnswer(comentarioId, respuesta) {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            // Construye la URL dinámicamente en JavaScript
            const url = `/tienda/marcar_utilidad_reseña/${comentarioId}/`;
        
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ utilidad: respuesta }) // Enviar el valor de la respuesta (si/no)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Respuesta guardada: ' + data.utilidad);
                    const selectedRadio = document.querySelector(`input[name="utilidad_${comentarioId}"][value="${data.utilidad}"]`);
                    if (selectedRadio) {
                        selectedRadio.checked = true;
                    }
                } else {
                    console.error('Error al guardar la respuesta: ' + data.error);
                }
            })
            .catch(error => console.error('Error en la solicitud:', error));
        }
        
    </script>









<script src="{% static 'js/vista.js'%}"></script>
</body>
</html>